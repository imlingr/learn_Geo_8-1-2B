<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸­åœ‹ä¸»è¦éƒ½å¸‚åœ°åœ–å¡«ç©ºæ¸¬é©—</title>
    
    <style>
        :root {
            --primary-color: #007bff;
            --highlight-color: #ff0000; /* é¸å–æ™‚çš„ç´…è‰² */
            --bg-color: #f0f2f5;
        }

        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            /* é˜²æ­¢åœ¨æ‰‹æ©Ÿä¸Šé•·æŒ‰é¸å–æ–‡å­— */
            user-select: none; 
            -webkit-user-select: none;
            /* é˜²æ­¢ iOS ä¸Šçš„é•·æŒ‰è·³å‡ºé¸å–® */
            -webkit-touch-callout: none;
        }

        h1 {
            color: #333;
            font-size: 24px;
            margin: 10px 0;
            text-align: center;
        }

        /* --- ä½œç­”èªªæ˜å°å¼•é æ¨£å¼ --- */
        #instruction-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #instruction-box {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 90%;
            width: 500px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }

        #instruction-box h2 {
            margin-top: 0;
            color: var(--primary-color);
        }

        .instruction-step {
            margin: 20px 0;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .icon-group {
            display: inline-flex;
            align-items: center;
            background-color: #f9f9f9;
            padding: 5px 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .instruct-icon { font-size: 24px; }
        .instruct-text { font-weight: bold; margin: 0 5px; color: #555; }
        .arrow { font-size: 24px; color: var(--primary-color); }

        #start-game-btn {
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
        }

        #start-game-btn:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }
        /* ------------------------ */


        #game-container {
            display: flex;
            gap: 10px;
            background-color: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            max-width: 100%; 
            overflow-x: auto; 
            -webkit-overflow-scrolling: touch;
        }

        #source-container {
            width: 160px;
            min-width: 160px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-content: flex-start;
            border-right: 2px solid #eee;
            padding-right: 10px;
            height: 593px; 
            overflow-y: auto;
            -webkit-overflow-scrolling: touch; 
        }

        /* ä¾†æºå€çš„å­—å¡æ¨£å¼ */
        .card {
            padding: 8px 12px;
            background-color: #fff;
            border: 2px solid #ffd700; 
            border-radius: 5px;
            cursor: pointer; /* æ”¹ç‚ºæ‰‹æŒ‡æ¸¸æ¨™ */
            font-weight: bold;
            font-size: 15px; 
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            transition: all 0.2s;
            display: inline-block;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* è¢«é¸ä¸­çš„å­—å¡æˆ–é¡Œæ¡†æ¨£å¼ */
        .selected {
            border-color: var(--highlight-color) !important;
            box-shadow: 0 0 10px var(--highlight-color) !important;
            transform: scale(1.05);
        }

        /* å­—å¡æ”¾å…¥åœ°åœ–å¾Œçš„æ¨£å¼ */
        .drop-zone .card {
            font-size: 10px; 
            padding: 0px; 
            border-width: 1px; 
            border-radius: 2px;
            white-space: nowrap; 
            box-shadow: none; 
            margin: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #ffffcc; 
            cursor: pointer;
        }
        
        /* ä½œç­”æ¬¡æ•¸é¡è‰² */
        .attempt-1 { color: blue; border-color: blue; }
        .attempt-2 { color: green; border-color: green; }
        .attempt-3 { color: orange; border-color: orange; }
        .attempt-4 { color: hotpink; border-color: hotpink; }

        #map-container {
            position: relative;
            width: 800px; 
            height: 593px; 
            min-width: 800px; 
            min-height: 593px;
            background-image: url('image_1.png'); /* è«‹ç¢ºä¿ image_1.png åœ¨åŒä¸€ç›®éŒ„ä¸‹ */
            background-size: cover;
            border: 2px solid #ccc;
            border-radius: 5px;
        }

        /* é¡Œç›®æ¡†æ¨£å¼ */
        .drop-zone {
            position: absolute;
            height: 20px; 
            border: 1px solid var(--primary-color); 
            background-color: rgba(255, 255, 255, 0.8); 
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 3px;
            transition: all 0.3s;
            z-index: 10; 
            box-sizing: border-box;
            cursor: pointer; /* æ”¹ç‚ºæ‰‹æŒ‡æ¸¸æ¨™ */
            -webkit-tap-highlight-color: transparent;
        }
        
        /* æ‰¹é–±å¾Œçš„ç‹€æ…‹ */
        .drop-zone.correct {
            border: 2px solid green;
            background-color: rgba(144, 238, 144, 0.8);
            z-index: 11; 
            pointer-events: none; /* ç­”å°å¾Œé–å®šï¼Œä¸å¯å†é»æ“Š */
        }
        
        .drop-zone.incorrect {
            border: 2px solid red;
            background-color: rgba(255, 99, 71, 0.8);
            z-index: 12; 
        }

        /* é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆçš„è¼”åŠ©æ¨™ç±¤ */
        .answer-label {
            position: absolute;
            top: -14px; 
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 9px;
            color: #d32f2f;
            font-weight: bold;
            text-shadow: 1px 1px 0px white, -1px -1px 0px white; 
            display: none;
            pointer-events: none; 
        }
        .drop-zone.incorrect .answer-label {
            display: block;
        }

        #controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-btn {
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            font-family: "Microsoft JhengHei";
            transition: background-color 0.2s;
            -webkit-tap-highlight-color: transparent; 
        }

        #submit-btn { background-color: #4CAF50; color: white; }
        #submit-btn:hover { background-color: #45a049; }
        
        #correct-btn { background-color: #FF9800; color: white; display: none;}
        #correct-btn:hover { background-color: #e68a00; }

        #retry-btn { background-color: #2196F3; color: white; display: none;}
        #retry-btn:hover { background-color: #0b7dda; }

        #score-display {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin: 10px 0;
        }
        
        #attempt-info {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
            text-align: center;
        }

    </style>
</head>
<body>

    <div id="instruction-overlay">
        <div id="instruction-box">
            <h2>ğŸ“œ ä½œç­”æ–¹å¼èªªæ˜</h2>
            
            <div class="instruction-step">
                <div class="icon-group">
                    <span class="instruct-icon">ğŸ‘†</span>
                    <span class="instruct-text">é»é¸ã€Œé¡Œæ¡†ã€</span>
                    <span class="instruct-text" style="color:red;">(è®Šè‰²)</span>
                </div>
                <span class="arrow">â•</span>
                <div class="icon-group">
                    <span class="instruct-icon">ğŸ‘†</span>
                    <span class="instruct-text">é»é¸ã€Œå­—å¡ã€</span>
                </div>
                <span class="arrow">â¡ï¸</span>
                <span class="instruct-text">å®Œæˆé…å° (åä¹‹äº¦å¯)</span>
            </div>

            <div class="instruction-step" style="margin-top: 30px;">
                <div class="icon-group">
                    <span class="instruct-icon">ğŸ‘†ğŸ‘†</span>
                    <span class="instruct-text">é€£é»å…©ä¸‹ã€Œå·²ç­”å­—å¡ã€</span>
                </div>
                <span class="arrow">â¡ï¸</span>
                <div class="icon-group">
                    <span class="instruct-icon">â†©ï¸</span>
                    <span class="instruct-text">æ¸…é™¤ç­”æ¡ˆï¼Œå­—å¡æ­¸ä½</span>
                </div>
            </div>

            <button id="start-game-btn">æˆ‘çŸ¥é“äº†ï¼Œé–‹å§‹ä½œç­”ï¼</button>
        </div>
    </div>


    <h1>ä¸­åœ‹ä¸»è¦éƒ½å¸‚åœ°åœ–å¡«ç©ºæ¸¬é©—</h1>

    <div id="game-container">
        <div id="source-container">
            </div>

        <div id="map-container">
            </div>
    </div>

    <div id="controls">
        <button id="submit-btn" class="control-btn">æ‰¹é–±ç­”æ¡ˆ</button>
        <button id="correct-btn" class="control-btn">éŒ¯é¡Œè¨‚æ­£</button>
        <button id="retry-btn" class="control-btn">é‡æ–°æŒ‘æˆ°</button>
        <div id="score-display">å°šæœªæ‰¹é–±</div>
    </div>
    <div id="attempt-info">ç•¶å‰ä½œç­”æ¬¡æ•¸ï¼šç¬¬ <span id="attempt-count">1</span> æ¬¡ (å­—è‰²æ¨™ç¤º)</div>

    <script>
        // é—œé–‰å°å¼•é 
        document.getElementById('start-game-btn').addEventListener('click', function() {
            document.getElementById('instruction-overlay').style.display = 'none';
        });

        // éƒ½å¸‚è³‡æ–™èˆ‡å…¶åœ¨åœ°åœ–ä¸Šçš„ç›¸å°ä½ç½® (ç™¾åˆ†æ¯” top, left)
        const cityData = [
            { name: 'çƒé­¯æœ¨é½Š', top: 25.5, left: 22.5 },
            { name: 'å–€ä»€', top: 32, left: 10.5 },
            { name: 'æ•¦ç…Œ', top: 36, left: 32 },
            { name: 'æ‹‰è–©', top: 60, left: 24.5 },
            { name: 'è˜­å·', top: 50.5, left: 47 },
            { name: 'è¥¿å®‰', top: 55, left: 54 },
            { name: 'æˆéƒ½', top: 62, left: 45.5 },
            { name: 'é‡æ…¶', top: 67, left: 51 },
            { name: 'é„­å·', top: 49, left: 60.5 },
            { name: 'æ­¦æ¼¢', top: 59, left: 63 },
            { name: 'å—äº¬', top: 54, left: 71.5 },
            { name: 'è˜‡å·', top: 55.5, left: 75.5 },
            { name: 'ä¸Šæµ·', top: 57.5, left: 78.5 },
            { name: 'æ­å·', top: 61, left: 75 },
            { name: 'ç¦å·', top: 72, left: 73.5 },
            { name: 'å»ˆé–€', top: 76, left: 71.5 },
            { name: 'å»£å·', top: 79, left: 63 },
            { name: 'æ·±åœ³', top: 80.5, left: 66 },
            { name: 'ç æµ·', top: 81.5, left: 60.5 },
            { name: 'é¦™æ¸¯', top: 83, left: 67.5 },
            { name: 'æ¾³é–€', top: 84, left: 61.5 },
            { name: 'æµ·å£', top: 89, left: 59.5 },
            { name: 'åŒ—äº¬', top: 38, left: 63.5 },
            { name: 'å¤©æ´¥', top: 40, left: 66.5 },
            { name: 'é’å³¶', top: 46.5, left: 70.5 },
            { name: 'å¤§é€£', top: 40, left: 74.5 },
            { name: 'ç€‹é™½', top: 32, left: 77 },
            { name: 'å“ˆçˆ¾æ¿±', top: 19, left: 81 }
        ];

        const targetCities = cityData.map(city => city.name);
        const quizData = cityData;

        let currentAttempt = 1;
        const maxScore = targetCities.length;

        const sourceContainer = document.getElementById('source-container');
        const mapContainer = document.getElementById('map-container');
        const submitBtn = document.getElementById('submit-btn');
        const correctBtn = document.getElementById('correct-btn');
        const retryBtn = document.getElementById('retry-btn');
        const scoreDisplay = document.getElementById('score-display');
        const attemptCountSpan = document.getElementById('attempt-count');

        // --- æ–°å¢ï¼šç‹€æ…‹è®Šæ•¸ ---
        let selectedDropZone = null;
        let selectedCard = null;

        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            sourceContainer.innerHTML = '';
            mapContainer.innerHTML = '';
            const oldImg = mapContainer.querySelector('img');
            if(oldImg) oldImg.remove();
            clearSelections();

            quizData.forEach(city => {
                // å»ºç«‹å­—å¡ (ä¸å†æ˜¯ draggable)
                const card = document.createElement('div');
                card.classList.add('card', `attempt-${currentAttempt}`);
                card.id = 'city-' + city.name;
                card.textContent = city.name;
                sourceContainer.appendChild(card);

                // å»ºç«‹æ”¾ç½®å€åŸŸ
                const dropZone = document.createElement('div');
                dropZone.classList.add('drop-zone');
                dropZone.style.top = city.top + '%';
                dropZone.style.left = city.left + '%';
                
                // æ ¹æ“šå­—æ•¸è¨­å®šå¯¬åº¦
                let width = 42; 
                if (city.name.length > 3) width = 54;
                if (city.name.length <= 2) width = 32;
                dropZone.style.width = width + 'px';
                dropZone.style.marginLeft = -(width / 2) + 'px';
                dropZone.style.marginTop = '-10px';

                dropZone.dataset.correctCity = city.name;
                
                const answerLabel = document.createElement('div');
                answerLabel.classList.add('answer-label');
                answerLabel.textContent = city.name;
                dropZone.appendChild(answerLabel);

                mapContainer.appendChild(dropZone);
            });

            setupInteractions();
            updateAttemptUI();
        }

        // --- æ–°å¢ï¼šæ¸…é™¤æ‰€æœ‰é¸å–ç‹€æ…‹ ---
        function clearSelections() {
            if (selectedDropZone) selectedDropZone.classList.remove('selected');
            if (selectedCard) selectedCard.classList.remove('selected');
            selectedDropZone = null;
            selectedCard = null;
        }

        // --- æ–°å¢ï¼šè¨­å®šé»æ“Šäº’å‹•äº‹ä»¶ ---
        function setupInteractions() {
            const cards = document.querySelectorAll('.card');
            const dropZones = document.querySelectorAll('.drop-zone');

            // ä¾†æºå€å­—å¡çš„é»æ“Šäº‹ä»¶
            cards.forEach(card => {
                card.addEventListener('click', (e) => {
                    // å¦‚æœå¡ç‰‡å·²ç¶“åœ¨é¡Œæ¡†ä¸­ï¼Œå–®é»ä¸åŸ·è¡Œå‹•ä½œ (ç­‰å¾…é›™æ“Šæ¸…é™¤)
                    if (card.parentElement.classList.contains('drop-zone')) return;

                    e.stopPropagation(); // é˜²æ­¢äº‹ä»¶å†’æ³¡

                    if (selectedDropZone) {
                        // è¦å‰‡ 1: è‹¥å·²é¸é¡Œæ¡†ï¼Œå†é»å­—å¡ -> é…å°
                        moveCardToZone(card, selectedDropZone);
                    } else {
                        // è¦å‰‡ 2/5: è‹¥æ²’é¸é¡Œæ¡†ï¼Œæˆ–é»é¸å¦ä¸€å€‹å­—å¡ -> é¸å–æ­¤å­—å¡
                        if (selectedCard) selectedCard.classList.remove('selected');
                        selectedCard = card;
                        card.classList.add('selected');
                    }
                });
            });

            // é¡Œæ¡†çš„é»æ“Šäº‹ä»¶
            dropZones.forEach(zone => {
                zone.addEventListener('click', (e) => {
                    // å¦‚æœé¡Œæ¡†å·²ç¶“é–å®š(ç­”å°)ï¼Œå‰‡å¿½ç•¥
                    if (zone.classList.contains('correct')) return;
                    
                    // å¦‚æœé¡Œæ¡†å…§å·²æœ‰å­—å¡ï¼Œå–®é»ä¸åŸ·è¡Œå‹•ä½œ
                    if (zone.querySelector('.card')) return;

                    e.stopPropagation();

                    if (selectedCard) {
                         // è¦å‰‡ 2: è‹¥å·²é¸å­—å¡ï¼Œå†é»é¡Œæ¡† -> é…å°
                        moveCardToZone(selectedCard, zone);
                    } else {
                        // è¦å‰‡ 1/4: è‹¥æ²’é¸å­—å¡ï¼Œæˆ–é»é¸å¦ä¸€å€‹é¡Œæ¡† -> é¸å–æ­¤é¡Œæ¡†
                        if (selectedDropZone) selectedDropZone.classList.remove('selected');
                        selectedDropZone = zone;
                        zone.classList.add('selected');
                    }
                });
            });

            // è¦å‰‡ 3: å·²è²¼åˆ°é¡Œæ¡†ä¸­å­—å¡çš„é›™æ“Šäº‹ä»¶ (æ¸…é™¤ç­”æ¡ˆ)
            // ä½¿ç”¨äº‹ä»¶å§”æ´¾ï¼Œç›£è½ mapContainer
            mapContainer.addEventListener('dblclick', (e) => {
                const card = e.target.closest('.card');
                // ç¢ºä¿é»åˆ°çš„æ˜¯å¡ç‰‡ï¼Œä¸”å¡ç‰‡åœ¨é¡Œæ¡†å…§ï¼Œä¸”é¡Œæ¡†æœªé–å®š
                if (card && card.parentElement.classList.contains('drop-zone') && !card.parentElement.classList.contains('correct')) {
                    e.stopPropagation();
                    e.preventDefault(); // é˜²æ­¢è¡Œå‹•è£ç½®é›™æ“Šç¸®æ”¾
                    
                    // å°‡å¡ç‰‡ç§»å›ä¾†æºå€
                    sourceContainer.appendChild(card);
                    resetCardColor(card);
                }
            });

            // é»æ“Šç©ºç™½è™•å–æ¶ˆé¸å–
            document.addEventListener('click', clearSelections);
        }

        // --- æ–°å¢ï¼šåŸ·è¡Œé…å°å‹•ä½œ ---
        function moveCardToZone(card, zone) {
            resetCardColor(card);
            zone.appendChild(card);
            clearSelections();
        }
        
        function resetCardColor(card) {
             card.classList.remove('attempt-1', 'attempt-2', 'attempt-3', 'attempt-4');
             let colorClass = `attempt-${currentAttempt > 4 ? 4 : currentAttempt}`;
             card.classList.add(colorClass);
        }

        function updateAttemptUI() {
            attemptCountSpan.textContent = currentAttempt;
            let color = 'blue';
            if (currentAttempt === 2) color = 'green';
            else if (currentAttempt === 3) color = 'orange';
            else if (currentAttempt >= 4) color = 'hotpink';
            attemptCountSpan.style.color = color;
        }

        // æ‰¹é–±åŠŸèƒ½
        submitBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            clearSelections(); // æ‰¹é–±å‰æ¸…é™¤é¸å–ç‹€æ…‹

            let score = 0;
            const dropZones = document.querySelectorAll('.drop-zone');
            let allFilled = true;

            dropZones.forEach(zone => {
                zone.classList.remove('correct', 'incorrect');
                const card = zone.querySelector('.card');
                const correctCity = zone.dataset.correctCity;

                if (card) {
                    if (card.textContent === correctCity) {
                        score++;
                        zone.classList.add('correct');
                        // ç­”å°çš„å¡ç‰‡ä¸å†éŸ¿æ‡‰æ»‘é¼ äº‹ä»¶ï¼Œé¿å…è¢«é»é¸æˆ–é›™æ“Š
                        card.style.pointerEvents = 'none';
                    } else {
                        zone.classList.add('incorrect');
                    }
                } else {
                    zone.classList.add('incorrect');
                    allFilled = false;
                }
            });

            scoreDisplay.textContent = `å¾—åˆ†ï¼š${score} / ${maxScore}`;
            submitBtn.style.display = 'none';
            correctBtn.style.display = 'inline-block';
            retryBtn.style.display = 'inline-block';
        });

        // éŒ¯é¡Œè¨‚æ­£åŠŸèƒ½
        correctBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            currentAttempt++;
            updateAttemptUI();
            
            const dropZones = document.querySelectorAll('.drop-zone');
            dropZones.forEach(zone => {
                if (zone.classList.contains('incorrect')) {
                    const card = zone.querySelector('.card');
                    if (card) {
                        sourceContainer.appendChild(card);
                        resetCardColor(card);
                    }
                    zone.classList.remove('incorrect');
                }
            });
            
            const sourceCards = sourceContainer.querySelectorAll('.card');
            sourceCards.forEach(drag => {
                 resetCardColor(drag);
            });

            scoreDisplay.textContent = 'è¨‚æ­£ä¸­...';
            submitBtn.style.display = 'inline-block';
            correctBtn.style.display = 'none';
        });

        // é‡æ–°æŒ‘æˆ°åŠŸèƒ½
        retryBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (confirm("ç¢ºå®šè¦é‡æ–°é–‹å§‹å—ï¼Ÿæ‰€æœ‰é€²åº¦å°‡æœƒéºå¤±ã€‚")) {
                currentAttempt = 1;
                scoreDisplay.textContent = 'å°šæœªæ‰¹é–±';
                submitBtn.style.display = 'inline-block';
                correctBtn.style.display = 'none';
                retryBtn.style.display = 'none';
                initGame();
            }
        });

        initGame();

    </script>
</body>
</html>

